/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => DeepseekGeneratorPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_STYLES = [
  { name: "\u81EA\u7136\u6D41\u7545\uFF0C\u6587\u5B66\uFF0C\u6B63\u5F0F", description: "\u6587\u5B66\u6027\u5F3A\uFF0C\u8BED\u6C14\u6B63\u5F0F\uFF0C\u7ED3\u6784\u4E25\u8C28\u3002" },
  { name: "\u79D1\u5E7B\u6545\u4E8B\uFF0C\u60AC\u7591", description: "\u7740\u91CD\u4E8E\u6784\u5EFA\u79D1\u5E7B\u6216\u60AC\u7591\u60C5\u8282\u3002" },
  { name: "\u65E5\u8BB0\u4F53\uFF0C\u53CD\u601D", description: "\u4EE5\u7B2C\u4E00\u4EBA\u79F0\u65E5\u8BB0\u5F62\u5F0F\uFF0C\u8FDB\u884C\u6DF1\u5165\u53CD\u601D\u3002" },
  { name: "\u65B0\u95FB\u62A5\u9053\uFF0C\u5BA2\u89C2", description: "\u6A21\u62DF\u65B0\u95FB\u62A5\u9053\u7684\u5BA2\u89C2\u8BED\u6C14\u548C\u7ED3\u6784\u3002" }
];
var DEFAULT_SETTINGS = {
  apiKey: "",
  apiUrl: "https://api.deepseek.com/v1/chat/completions",
  model: "deepseek-chat",
  maxAttempts: 3,
  outputFilePath: "",
  // 默认路径
  keywordsFilePath: ""
  // 默认路径
};
var DeepseekGeneratorPlugin = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addCommand({
      id: "deepseek-generate-article",
      name: "Generate Article from Footnotes (Select Style)",
      checkCallback: (checking) => {
        const activeFile = this.app.workspace.getActiveFile();
        if (activeFile && activeFile.extension === "md") {
          if (!checking) {
            this.showGenerateModal(activeFile);
          }
          return true;
        }
        return false;
      }
    });
    this.addCommand({
      id: "deepseek-extract-keywords-only",
      name: "Extract Footnote Keywords to File",
      checkCallback: (checking) => {
        const activeFile = this.app.workspace.getActiveFile();
        if (activeFile && activeFile.extension === "md") {
          if (!checking) {
            this.handleGenerator(activeFile, "extract");
          }
          return true;
        }
        return false;
      }
    });
    this.addRibbonIcon("edit", "footnotelearn Menu", (evt) => {
      this.showRibbonMenu(evt);
    });
    this.addSettingTab(new DeepseekSettingTab(this.app, this));
  }
  async onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  // ====================== P4/P5: 菜单和 Modal 窗口 ======================
  /**
   * P4: 显示 Ribbon Icon 被点击时的下拉菜单
   */
  showRibbonMenu(event) {
    const activeFile = this.app.workspace.getActiveFile();
    const menu = new import_obsidian.Menu();
    const isMarkdown = activeFile && activeFile.extension === "md";
    menu.addItem((item) => {
      item.setTitle("\u751F\u6210 (Select Style)").setIcon("file-edit").onClick(() => {
        if (activeFile) {
          this.showGenerateModal(activeFile);
        }
      }).setDisabled(!isMarkdown);
    });
    menu.addItem((item) => {
      item.setTitle("\u6458\u5F55 (Save to File)").setIcon("copy").onClick(() => {
        if (activeFile) {
          this.handleGenerator(activeFile, "extract");
        }
      }).setDisabled(!isMarkdown);
    });
    menu.addSeparator();
    menu.addItem((item) => {
      item.setTitle("Open Settings").setIcon("settings").onClick(() => {
        this.app.setting.open();
        this.app.setting.openTabById(this.manifest.id);
      });
    });
    menu.showAtMouseEvent(event);
  }
  /**
   * P4/P5: 弹出风格选择 Modal
   */
  showGenerateModal(activeFile) {
    new GenerateStyleModal(this.app, activeFile, (style) => {
      if (style) {
        this.handleGenerator(activeFile, "auto", style.description);
      }
    }).open();
  }
  // ====================== 核心逻辑触发器 (handleGenerator) ======================
  /**
   * 主函数，负责读取、生成和写入
   */
  async handleGenerator(activeFile, mode, styleDescription) {
    let content;
    try {
      content = await this.app.vault.read(activeFile);
    } catch (e) {
      new import_obsidian.Notice(`\u274C \u65E0\u6CD5\u8BFB\u53D6\u6587\u4EF6: ${activeFile.path}`, 5e3);
      return;
    }
    const words = this.extractWordsFromMdContent(content);
    if (words.length === 0) {
      new import_obsidian.Notice("\u26A0\uFE0F \u6587\u4EF6\u4E2D\u672A\u627E\u5230\u4EFB\u4F55\u82F1\u6587\u811A\u6CE8\u5173\u952E\u8BCD\u3002", 3e3);
      return;
    }
    const wordsLine = words.join(", ");
    if (mode === "extract") {
      const wordDefMap = this.extractwordsDefinitions(content);
      if (wordDefMap.size === 0) {
        new import_obsidian.Notice("\u26A0\uFE0F \u6587\u4EF6\u4E2D\u672A\u627E\u5230\u811A\u6CE8\u3002", 3e3);
        return;
      }
      const filePath = this.settings.keywordsFilePath;
      const existingWords = await this.loadExistingWords(filePath);
      const contentToAppend = this.convertDictToBlocks(wordDefMap, existingWords);
      if (contentToAppend) {
        await this.appendOrCreateFile(filePath, contentToAppend, "\u5173\u952E\u8BCD");
      } else {
        new import_obsidian.Notice("\u26A0\uFE0F \u6CA1\u6709\u65B0\u5173\u952E\u8BCD\u9700\u8981\u8FFD\u52A0\u3002", 3e3);
      }
      return;
    }
    const res = await this.generateParagraph(words, styleDescription != null ? styleDescription : DEFAULT_STYLES[0].description);
    if (res.success) {
      const now = new Date().toISOString().slice(0, 16).replace("T", " ");
      const outputContent = `
---
####${now}
Source: [[${activeFile.path}]]

${res.text}
`;
      await this.appendOrCreateFile(this.settings.outputFilePath, outputContent, "\u6587\u7AE0");
    } else {
      new import_obsidian.Notice(`\u274C \u751F\u6210\u5931\u8D25\uFF0C\u8BF7\u67E5\u770B\u63A7\u5236\u53F0\u65E5\u5FD7\u3002`, 5e3);
      console.log(`\u274C Generation failed, final result: ${res.text}`);
    }
  }
  /**
   * P1/P2: 辅助函数，确保文件路径存在并追加内容
   */
  async appendOrCreateFile(filePath, content, type) {
    try {
      const vault = this.app.vault;
      const folderPath = filePath.substring(0, filePath.lastIndexOf("/"));
      if (folderPath && !await vault.adapter.exists(folderPath)) {
        await vault.createFolder(folderPath);
      }
      const file = vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian.TFile) {
        await vault.append(file, content);
        new import_obsidian.Notice(`\u2705 ${type}\u5DF2\u8FFD\u52A0\u5230 ${filePath}`, 4e3);
      } else {
        await vault.create(filePath, content);
        new import_obsidian.Notice(`\u2705 ${type}\u6587\u4EF6\u5DF2\u521B\u5EFA: ${filePath}`, 4e3);
      }
    } catch (e) {
      new import_obsidian.Notice(`\u274C \u65E0\u6CD5\u5199\u5165${type}\u6587\u4EF6: ${filePath}`, 5e3);
      console.error("File write error:", e);
    }
  }
  // ====================== 辅助函数 (核心逻辑) ======================
  // ... (extractWordsFromMdContent, containsAll 方法保持不变) ...
  extractwordsDefinitions(content) {
    const pattern = /\[\^\d+]:\s*([^:\n]+):\s*(.+)/gm;
    const matches = [...content.matchAll(pattern)];
    const wordDefMap = /* @__PURE__ */ new Map();
    for (const match of matches) {
      const word = match[1].trim();
      const definition = match[2].trim();
      if (word && !wordDefMap.has(word)) {
        wordDefMap.set(word, definition);
      }
    }
    return wordDefMap;
  }
  async loadExistingWords(filePath) {
    const existingWords = /* @__PURE__ */ new Set();
    const file = this.app.vault.getAbstractFileByPath(filePath);
    if (file instanceof import_obsidian.TFile) {
      try {
        const content = await this.app.vault.read(file);
        const pattern = /^#\s*([^#\n]+)$/gm;
        let match;
        while ((match = pattern.exec(content)) !== null) {
          existingWords.add(match[1].trim());
        }
      } catch (e) {
        console.error("Error reading existing keywords file:", e);
      }
    }
    return existingWords;
  }
  /**
   * 实现 Python 中的 convert_dict_to_blocks 逻辑。
   * 将提取的 Map 转换为新关键词文件的追加内容，格式为分块。
   */
  convertDictToBlocks(wordDefMap, existingWords) {
    const blocks = [];
    const sortedWords = Array.from(wordDefMap.keys()).sort();
    for (const word of sortedWords) {
      if (existingWords.has(word)) {
        continue;
      }
      const definition = wordDefMap.get(word) || "";
      const block = `# ${word}

${definition}

---
`;
      blocks.push(block);
    }
    if (blocks.length === 0)
      return "";
    return blocks.join("");
  }
  extractWordsFromMdContent(content) {
    const pattern = /\[\^\d+]:\s*([A-Za-z\-']+)(?::|\s|$)/gm;
    const matches = [...content.matchAll(pattern)];
    const words = matches.map((match) => match[1].trim());
    return Array.from(new Set(words));
  }
  containsAll(text, requiredWords) {
    const textLower = text.toLowerCase();
    for (const word of requiredWords) {
      try {
        const escapedWord = word.toLowerCase().replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&");
        const regex = new RegExp("\\b" + escapedWord + "\\b", "g");
        if (!regex.test(textLower)) {
          return false;
        }
      } catch (e) {
        console.error(`Regex creation failed for word: ${word}`, e);
        return false;
      }
    }
    return true;
  }
  /**
   * 构建发送给 DeepSeek API 的用户提示，使用 style 参数。
   */
  buildPrompt(requiredWords, lengthDescription = "\u7EA6500\u8BCD", style = DEFAULT_STYLES[0].description) {
    const wordsLine = requiredWords.join(", ");
    const prompt = `\u8BF7\u7528\u82F1\u6587\u5199\u4E00\u7BC7${lengthDescription}\u8FDE\u8D2F\u591A\u6BB5\u843D\u7684\u6587\u7AE0\uFF0C\u98CE\u683C\uFF1A${style}\uFF0C\u5177\u6709\u4E00\u5B9A\u6545\u4E8B\u60C5\u8282\u3002
\u8981\u6C42\uFF1A\u6587\u7AE0\u4E2D\u5FC5\u987B\u5305\u542B\u4EE5\u4E0B\u5173\u952E\u8BCD\uFF08\u4EFB\u610F\u8BCD\u5F62\u53D8\u5316\u5747\u53EF\uFF09\uFF1A${wordsLine}\u3002\u5E76\u5728\u7ED3\u679C\u4E2D\u5C06\u76F8\u5E94\u5355\u8BCD\u6216\u8005\u5176\u53D8\u5F62\u52A0\u7C97
\u4E0D\u8981\u4F7F\u7528\u9879\u76EE\u7B26\u53F7\uFF0C\u53EF\u5206\u6BB5\uFF0C\u4FDD\u6301\u81EA\u7136\u8FDE\u8D2F\u7684\u8BED\u6C14\u3002`;
    return prompt;
  }
  /**
   * 核心生成函数，传入 style 参数。
   */
  async generateParagraph(requiredWords, styleDescription, lengthDesc = "\u7EA6400\u8BCD") {
    var _a, _b, _c, _d;
    const { apiKey, apiUrl, model, maxAttempts } = this.settings;
    if (!apiKey) {
      new import_obsidian.Notice("\u274C DeepSeek API Key \u672A\u8BBE\u7F6E\u3002\u8BF7\u68C0\u67E5\u63D2\u4EF6\u8BBE\u7F6E\u3002", 8e3);
      return { success: false, text: "API Key Missing" };
    }
    const headers = {
      "Authorization": `Bearer ${apiKey}`,
      "Content-Type": "application/json"
    };
    const systemPrompt = "\u4F60\u662F\u4E00\u4E2A\u64C5\u957F\u5199\u4F5C\u7684\u82F1\u6587\u6587\u7AE0\u751F\u6210\u52A9\u624B\u3002";
    let userPrompt = this.buildPrompt(requiredWords, lengthDesc, styleDescription);
    let lastText = "";
    for (let attempt = 1; attempt <= maxAttempts; attempt++) {
      new import_obsidian.Notice(`\u{1F916} Attempt ${attempt}/${maxAttempts} to generate...`);
      const payload = {
        model,
        messages: [
          { "role": "system", "content": systemPrompt },
          { "role": "user", "content": userPrompt }
        ],
        temperature: 0.8,
        max_tokens: 1024
      };
      try {
        const response = await (0, import_obsidian.requestUrl)({ url: apiUrl, method: "POST", body: JSON.stringify(payload), headers, throw: false });
        if (response.status === 401) {
          throw new Error("\u274C Authentication Failed.");
        }
        if (response.status !== 200) {
          throw new Error(`API Error ${response.status}: ${((_a = JSON.parse(response.text).error) == null ? void 0 : _a.message) || response.text}`);
        }
        const data = JSON.parse(response.text);
        const text = ((_d = (_c = (_b = data.choices[0]) == null ? void 0 : _b.message) == null ? void 0 : _c.content) == null ? void 0 : _d.trim()) || "";
        lastText = text;
        if (!text) {
          throw new Error("API returned empty content.");
        }
        if (this.containsAll(text, requiredWords)) {
          return { success: true, text };
        } else {
          const missing = requiredWords.filter((w) => !this.containsAll(text, [w]));
          console.warn(`Attempt ${attempt} missing words: ${missing.join(", ")}`);
          userPrompt = this.buildPrompt(requiredWords, lengthDesc, styleDescription) + `
\u6CE8\u610F\uFF1A\u4E0A\u6B21\u8F93\u51FA\u7F3A\u5C11\u8FD9\u4E9B\u5173\u952E\u8BCD\uFF1A${missing.join(", ")}\uFF0C\u8BF7\u52A1\u5FC5\u5305\u542B\u3002`;
          await new Promise((resolve) => setTimeout(resolve, 1e3));
        }
      } catch (error) {
        new import_obsidian.Notice(`\u274C \u751F\u6210\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF: ${error.message}`, 1e4);
        return { success: false, text: `Error: ${error.message}` };
      }
    }
    new import_obsidian.Notice("\u274C \u8FBE\u5230\u6700\u5927\u5C1D\u8BD5\u6B21\u6570\uFF0C\u751F\u6210\u5931\u8D25\u3002", 5e3);
    return { success: false, text: lastText || "Maximum attempts reached, no valid content generated." };
  }
};
var GenerateStyleModal = class extends import_obsidian.Modal {
  constructor(app, activeFile, callback) {
    super(app);
    this.activeFile = activeFile;
    this.callback = callback;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h2", { text: `Select Article Style for: ${this.activeFile.name}` });
    DEFAULT_STYLES.forEach((style) => {
      new import_obsidian.Setting(contentEl).setName(style.name).setDesc(style.description).addButton((button) => button.setButtonText("Select").setCta().onClick(() => {
        this.callback(style);
        this.close();
      }));
    });
    new import_obsidian.Setting(contentEl).addButton((button) => button.setButtonText("Cancel").onClick(() => {
      this.callback(null);
      this.close();
    }));
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var DeepseekSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "footnotelearn Settings" });
    new import_obsidian.Setting(containerEl).setName("DeepSeek API Key").setDesc("Enter your DeepSeek API Key (sk-xxxxxxxx...).").addText((text) => text.setPlaceholder("sk-xxxxxxxx...").setValue(this.plugin.settings.apiKey).onChange((0, import_obsidian.debounce)(async (value) => {
      this.plugin.settings.apiKey = value.trim();
      await this.plugin.saveSettings();
    }, 500)));
    new import_obsidian.Setting(containerEl).setName("Generated Articles File Path").setDesc("The path to the file where AI generated articles will be appended (e.g., DeepSeek/Generated_Articles.md).").addText((text) => text.setPlaceholder("DeepSeek/Generated_Articles.md").setValue(this.plugin.settings.outputFilePath).onChange((0, import_obsidian.debounce)(async (value) => {
      this.plugin.settings.outputFilePath = value.trim();
      await this.plugin.saveSettings();
    }, 500)));
    new import_obsidian.Setting(containerEl).setName("Extracted Keywords File Path").setDesc("The path to the file where extracted keywords will be appended (e.g., DeepSeek/Extracted_Keywords.md).").addText((text) => text.setPlaceholder("DeepSeek/Extracted_Keywords.md").setValue(this.plugin.settings.keywordsFilePath).onChange((0, import_obsidian.debounce)(async (value) => {
      this.plugin.settings.keywordsFilePath = value.trim();
      await this.plugin.saveSettings();
    }, 500)));
    new import_obsidian.Setting(containerEl).setName("DeepSeek API URL").setDesc("The URL for the DeepSeek Chat API.").addText((text) => text.setPlaceholder("https://api.deepseek.com/v1/...").setValue(this.plugin.settings.apiUrl).onChange((0, import_obsidian.debounce)(async (value) => {
      this.plugin.settings.apiUrl = value.trim();
      await this.plugin.saveSettings();
    }, 500)));
    new import_obsidian.Setting(containerEl).setName("Maximum Attempts").setDesc("Max number of retries if keywords are missed.").addText((text) => text.setPlaceholder("3").setValue(String(this.plugin.settings.maxAttempts)).onChange((0, import_obsidian.debounce)(async (value) => {
      let num = parseInt(value.trim());
      if (isNaN(num) || num < 1)
        num = 3;
      this.plugin.settings.maxAttempts = num;
      await this.plugin.saveSettings();
    }, 500)));
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgcHJpdmF0ZURlY3J5cHQgfSBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHsgXG4gICAgQXBwLCBFZGl0b3IsIE1hcmtkb3duVmlldywgTW9kYWwsIE5vdGljZSwgUGx1Z2luLCBcbiAgICBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCByZXF1ZXN0VXJsLCBSZXF1ZXN0VXJsUGFyYW0sIFxuICAgIFRGaWxlLCBWYXVsdCwgTWVudSwgVEZvbGRlciwgZGVib3VuY2Vcbn0gZnJvbSAnb2JzaWRpYW4nO1xuXG4vLyAtLS0gMS4gXHU4QkJFXHU3RjZFXHU2M0E1XHU1M0UzXHUzMDAxXHU5RUQ4XHU4QkE0XHU1MDNDXHU1NDhDIEFJIFx1OThDRVx1NjgzQ1x1NUI5QVx1NEU0OSAtLS1cblxuaW50ZXJmYWNlIEFpU3R5bGUge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xufVxuXG5jb25zdCBERUZBVUxUX1NUWUxFUzogQWlTdHlsZVtdID0gW1xuICAgIHsgbmFtZTogXCJcdTgxRUFcdTcxMzZcdTZENDFcdTc1NDVcdUZGMENcdTY1ODdcdTVCNjZcdUZGMENcdTZCNjNcdTVGMEZcIiwgZGVzY3JpcHRpb246IFwiXHU2NTg3XHU1QjY2XHU2MDI3XHU1RjNBXHVGRjBDXHU4QkVEXHU2QzE0XHU2QjYzXHU1RjBGXHVGRjBDXHU3RUQzXHU2Nzg0XHU0RTI1XHU4QzI4XHUzMDAyXCIgfSxcbiAgICB7IG5hbWU6IFwiXHU3OUQxXHU1RTdCXHU2NTQ1XHU0RThCXHVGRjBDXHU2MEFDXHU3NTkxXCIsIGRlc2NyaXB0aW9uOiBcIlx1Nzc0MFx1OTFDRFx1NEU4RVx1Njc4NFx1NUVGQVx1NzlEMVx1NUU3Qlx1NjIxNlx1NjBBQ1x1NzU5MVx1NjBDNVx1ODI4Mlx1MzAwMlwiIH0sXG4gICAgeyBuYW1lOiBcIlx1NjVFNVx1OEJCMFx1NEY1M1x1RkYwQ1x1NTNDRFx1NjAxRFwiLCBkZXNjcmlwdGlvbjogXCJcdTRFRTVcdTdCMkNcdTRFMDBcdTRFQkFcdTc5RjBcdTY1RTVcdThCQjBcdTVGNjJcdTVGMEZcdUZGMENcdThGREJcdTg4NENcdTZERjFcdTUxNjVcdTUzQ0RcdTYwMURcdTMwMDJcIiB9LFxuICAgIHsgbmFtZTogXCJcdTY1QjBcdTk1RkJcdTYyQTVcdTkwNTNcdUZGMENcdTVCQTJcdTg5QzJcIiwgZGVzY3JpcHRpb246IFwiXHU2QTIxXHU2MkRGXHU2NUIwXHU5NUZCXHU2MkE1XHU5MDUzXHU3Njg0XHU1QkEyXHU4OUMyXHU4QkVEXHU2QzE0XHU1NDhDXHU3RUQzXHU2Nzg0XHUzMDAyXCIgfSxcbl07XG5cbmludGVyZmFjZSBEZWVwc2Vla0dlbmVyYXRvclNldHRpbmdzIHtcbiAgICBhcGlLZXk6IHN0cmluZztcbiAgICBhcGlVcmw6IHN0cmluZztcbiAgICBtb2RlbDogc3RyaW5nO1xuICAgIG1heEF0dGVtcHRzOiBudW1iZXI7XG4gICAgLy8gUDE6IEFJIFx1NzUxRlx1NjIxMFx1NTE4NVx1NUJCOVx1OEY5M1x1NTFGQVx1OERFRlx1NUY4NFxuICAgIG91dHB1dEZpbGVQYXRoOiBzdHJpbmc7IFxuICAgIC8vIFAyOiBcdTUxNzNcdTk1MkVcdThCQ0RcdTY0NThcdTVGNTVcdThGOTNcdTUxRkFcdThERUZcdTVGODRcbiAgICBrZXl3b3Jkc0ZpbGVQYXRoOiBzdHJpbmc7IFxufVxuXG5jb25zdCBERUZBVUxUX1NFVFRJTkdTOiBEZWVwc2Vla0dlbmVyYXRvclNldHRpbmdzID0ge1xuICAgIGFwaUtleTogXCJcIiwgXG4gICAgYXBpVXJsOiBcImh0dHBzOi8vYXBpLmRlZXBzZWVrLmNvbS92MS9jaGF0L2NvbXBsZXRpb25zXCIsXG4gICAgbW9kZWw6IFwiZGVlcHNlZWstY2hhdFwiLFxuICAgIG1heEF0dGVtcHRzOiAzLFxuICAgIG91dHB1dEZpbGVQYXRoOiBcIlwiLCAvLyBcdTlFRDhcdThCQTRcdThERUZcdTVGODRcbiAgICBrZXl3b3Jkc0ZpbGVQYXRoOiBcIlwiLCAvLyBcdTlFRDhcdThCQTRcdThERUZcdTVGODRcbn1cblxuLy8gLS0tIDIuIFx1NjgzOFx1NUZDM1x1NjNEMlx1NEVGNlx1N0M3QiAtLS1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGVlcHNlZWtHZW5lcmF0b3JQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICAgIHNldHRpbmdzOiBEZWVwc2Vla0dlbmVyYXRvclNldHRpbmdzO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuICAgICAgICBcbiAgICAgICAgLy8gLS0tIFAzOiBcdTRGRERcdTc1NTlcdTU0N0RcdTRFRTQgLS0tXG4gICAgICAgIFxuICAgICAgICAvLyBcdTU0N0RcdTRFRTQgMTogXHU4MUVBXHU1MkE4XHU3NTFGXHU2MjEwXHU2NTg3XHU3QUUwXHVGRjA4XHU1RjM5XHU1MUZBXHU5OENFXHU2ODNDXHU5MDA5XHU2MkU5XHU3QTk3XHU1M0UzXHVGRjA5XG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ2RlZXBzZWVrLWdlbmVyYXRlLWFydGljbGUnLFxuICAgICAgICAgICAgbmFtZTogJ0dlbmVyYXRlIEFydGljbGUgZnJvbSBGb290bm90ZXMgKFNlbGVjdCBTdHlsZSknLFxuICAgICAgICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlRmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbGUgJiYgYWN0aXZlRmlsZS5leHRlbnNpb24gPT09ICdtZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUDU6IFx1NTQ3RFx1NEVFNFx1ODg0Q1x1ODlFNlx1NTNEMVx1NjVGNlx1NUYzOVx1NTFGQVx1OThDRVx1NjgzQ1x1OTAwOVx1NjJFOVx1N0E5N1x1NTNFM1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93R2VuZXJhdGVNb2RhbChhY3RpdmVGaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFx1NTQ3RFx1NEVFNCAyOiBcdTRFQzVcdTYzRDBcdTUzRDZcdTUxNzNcdTk1MkVcdThCQ0RcbiAgICAgICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgICAgICAgIGlkOiAnZGVlcHNlZWstZXh0cmFjdC1rZXl3b3Jkcy1vbmx5JyxcbiAgICAgICAgICAgIG5hbWU6ICdFeHRyYWN0IEZvb3Rub3RlIEtleXdvcmRzIHRvIEZpbGUnLFxuICAgICAgICAgICAgY2hlY2tDYWxsYmFjazogKGNoZWNraW5nOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlRmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbGUgJiYgYWN0aXZlRmlsZS5leHRlbnNpb24gPT09ICdtZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjaGVja2luZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVHZW5lcmF0b3IoYWN0aXZlRmlsZSwgJ2V4dHJhY3QnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyAtLS0gUDQ6IFx1NkRGQlx1NTJBMFx1NUUyNlx1ODNEQ1x1NTM1NVx1NzY4NCBSaWJib24gXHU1NkZFXHU2ODA3IC0tLVxuICAgICAgICB0aGlzLmFkZFJpYmJvbkljb24oJ2VkaXQnLCAnZm9vdG5vdGVsZWFybiBNZW51JywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaG93UmliYm9uTWVudShldnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFx1NkNFOFx1NTE4Q1x1OEJCRVx1N0Y2RVx1OTc2Mlx1Njc3RlxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IERlZXBzZWVrU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICAgIH1cblxuICAgIGFzeW5jIG9udW5sb2FkKCkge1xuICAgICAgICAvLyBcdTYzRDJcdTRFRjZcdTUzNzhcdThGN0RcdTY1RjZcdTc2ODRcdTZFMDVcdTc0MDZcdTkwM0JcdThGOTFcdUZGMDhcdTU5ODJcdTY3MDlcdTk3MDBcdTg5ODFcdTUzRUZcdTZERkJcdTUyQTBcdUZGMDlcbiAgICB9XG5cbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB9XG4gICAgXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PSBQNC9QNTogXHU4M0RDXHU1MzU1XHU1NDhDIE1vZGFsIFx1N0E5N1x1NTNFMyA9PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvKipcbiAgICAgKiBQNDogXHU2NjNFXHU3OTNBIFJpYmJvbiBJY29uIFx1ODhBQlx1NzBCOVx1NTFGQlx1NjVGNlx1NzY4NFx1NEUwQlx1NjJDOVx1ODNEQ1x1NTM1NVxuICAgICAqL1xuICAgIHNob3dSaWJib25NZW51KGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuICAgICAgICBjb25zdCBtZW51ID0gbmV3IE1lbnUoKTtcbiAgICAgICAgY29uc3QgaXNNYXJrZG93biA9IGFjdGl2ZUZpbGUgJiYgYWN0aXZlRmlsZS5leHRlbnNpb24gPT09ICdtZCc7XG5cbiAgICAgICAgLy8gLS0tIFx1OTAwOVx1OTg3OSAxOiBcdTc1MUZcdTYyMTBcdTY1ODdcdTdBRTAgKFx1NUYzOVx1NTFGQVx1OThDRVx1NjgzQ1x1OTAwOVx1NjJFOSkgLS0tXG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaXRlbS5zZXRUaXRsZShcIlx1NzUxRlx1NjIxMCAoU2VsZWN0IFN0eWxlKVwiKVxuICAgICAgICAgICAgICAgIC5zZXRJY29uKFwiZmlsZS1lZGl0XCIpXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlRmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93R2VuZXJhdGVNb2RhbChhY3RpdmVGaWxlKTsgLy8gXHU1RjM5XHU1MUZBIE1vZGFsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zZXREaXNhYmxlZCghaXNNYXJrZG93bilcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gLS0tIFx1OTAwOVx1OTg3OSAyOiBcdTRFQzVcdTYzRDBcdTUzRDZcdTUxNzNcdTk1MkVcdThCQ0QgLS0tXG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaXRlbS5zZXRUaXRsZShcIlx1NjQ1OFx1NUY1NSAoU2F2ZSB0byBGaWxlKVwiKVxuICAgICAgICAgICAgICAgIC5zZXRJY29uKFwiY29weVwiKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlR2VuZXJhdG9yKGFjdGl2ZUZpbGUsICdleHRyYWN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zZXREaXNhYmxlZCghaXNNYXJrZG93bilcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtZW51LmFkZFNlcGFyYXRvcigpO1xuXG4gICAgICAgIC8vIC0tLSBcdTkwMDlcdTk4NzkgMzogXHU2MjUzXHU1RjAwXHU4QkJFXHU3RjZFIC0tLVxuICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGl0ZW0uc2V0VGl0bGUoXCJPcGVuIFNldHRpbmdzXCIpXG4gICAgICAgICAgICAgICAgLnNldEljb24oXCJzZXR0aW5nc1wiKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT3BlbiB0aGUgcGx1Z2luJ3Mgc2V0dGluZ3MgdGFiIHVzaW5nIHRoZSByZWNvbW1lbmRlZCBBUElcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAuc2V0dGluZy5vcGVuKCk7XG5cdFx0XHRcdFx0dGhpcy5hcHAuc2V0dGluZy5vcGVuVGFiQnlJZCh0aGlzLm1hbmlmZXN0LmlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWVudS5zaG93QXRNb3VzZUV2ZW50KGV2ZW50KTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogUDQvUDU6IFx1NUYzOVx1NTFGQVx1OThDRVx1NjgzQ1x1OTAwOVx1NjJFOSBNb2RhbFxuICAgICAqL1xuICAgIHNob3dHZW5lcmF0ZU1vZGFsKGFjdGl2ZUZpbGU6IFRGaWxlKSB7XG4gICAgICAgIG5ldyBHZW5lcmF0ZVN0eWxlTW9kYWwodGhpcy5hcHAsIGFjdGl2ZUZpbGUsIChzdHlsZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHN0eWxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVHZW5lcmF0b3IoYWN0aXZlRmlsZSwgJ2F1dG8nLCBzdHlsZS5kZXNjcmlwdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLm9wZW4oKTtcbiAgICB9XG4gICAgXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PSBcdTY4MzhcdTVGQzNcdTkwM0JcdThGOTFcdTg5RTZcdTUzRDFcdTU2NjggKGhhbmRsZUdlbmVyYXRvcikgPT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLyoqXG4gICAgICogXHU0RTNCXHU1MUZEXHU2NTcwXHVGRjBDXHU4RDFGXHU4RDIzXHU4QkZCXHU1M0Q2XHUzMDAxXHU3NTFGXHU2MjEwXHU1NDhDXHU1MTk5XHU1MTY1XG4gICAgICovXG4gICAgYXN5bmMgaGFuZGxlR2VuZXJhdG9yKGFjdGl2ZUZpbGU6IFRGaWxlLCBtb2RlOiAnYXV0bycgfCAnZXh0cmFjdCcsIHN0eWxlRGVzY3JpcHRpb24/OiBzdHJpbmcpIHtcbiAgICAgICAgLy8gMS4gXHU4QkZCXHU1M0Q2XHU2NTg3XHU0RUY2XHU1MTg1XHU1QkI5XG4gICAgICAgIGxldCBjb250ZW50OiBzdHJpbmc7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChhY3RpdmVGaWxlKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZShgXHUyNzRDIFx1NjVFMFx1NkNENVx1OEJGQlx1NTNENlx1NjU4N1x1NEVGNjogJHthY3RpdmVGaWxlLnBhdGh9YCwgNTAwMCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIDIuIFx1NjNEMFx1NTNENlx1NTM1NVx1OEJDRFxuICAgICAgICBjb25zdCB3b3JkcyA9IHRoaXMuZXh0cmFjdFdvcmRzRnJvbU1kQ29udGVudChjb250ZW50KTtcblxuICAgICAgICBpZiAod29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKFwiXHUyNkEwXHVGRTBGIFx1NjU4N1x1NEVGNlx1NEUyRFx1NjcyQVx1NjI3RVx1NTIzMFx1NEVGQlx1NEY1NVx1ODJGMVx1NjU4N1x1ODExQVx1NkNFOFx1NTE3M1x1OTUyRVx1OEJDRFx1MzAwMlwiLCAzMDAwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdvcmRzTGluZSA9IHdvcmRzLmpvaW4oJywgJyk7XG4gICAgICAgIFxuICAgICAgICAvLyAzLiBcdTU5MDRcdTc0MDYgJ2V4dHJhY3QnIFx1NkEyMVx1NUYwRiAoUDI6IFx1NTE5OVx1NTE2NVx1NTIzMFx1NTE3M1x1OTUyRVx1OEJDRFx1NjU4N1x1NEVGNilcbiAgICAgICAgaWYgKG1vZGUgPT09IFwiZXh0cmFjdFwiKSB7XG4gICAgICAgICAgICBjb25zdCB3b3JkRGVmTWFwID0gdGhpcy5leHRyYWN0d29yZHNEZWZpbml0aW9ucyhjb250ZW50KTtcbiAgICAgICAgICAgIGlmICh3b3JkRGVmTWFwLnNpemUgPT09IDApe1xuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJcdTI2QTBcdUZFMEYgXHU2NTg3XHU0RUY2XHU0RTJEXHU2NzJBXHU2MjdFXHU1MjMwXHU4MTFBXHU2Q0U4XHUzMDAyXCIsIDMwMDApO1xuXHUwMEEwIFx1MDBBMCBcdTAwQTAgXHUwMEEwIFx1MDBBMCBcdTAwQTAgXHUwMEEwIFx1MDBBMCByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgY29uc3QgZmlsZVBhdGggPSB0aGlzLnNldHRpbmdzLmtleXdvcmRzRmlsZVBhdGg7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ1dvcmRzID0gYXdhaXQgdGhpcy5sb2FkRXhpc3RpbmdXb3JkcyhmaWxlUGF0aCk7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50VG9BcHBlbmQgPSB0aGlzLmNvbnZlcnREaWN0VG9CbG9ja3Mod29yZERlZk1hcCwgZXhpc3RpbmdXb3Jkcyk7XG5cbiAgICAgICAgICAgIGlmIChjb250ZW50VG9BcHBlbmQpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmFwcGVuZE9yQ3JlYXRlRmlsZShmaWxlUGF0aCwgY29udGVudFRvQXBwZW5kLCBcIlx1NTE3M1x1OTUyRVx1OEJDRFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlx1MjZBMFx1RkUwRiBcdTZDQTFcdTY3MDlcdTY1QjBcdTUxNzNcdTk1MkVcdThCQ0RcdTk3MDBcdTg5ODFcdThGRkRcdTUyQTBcdTMwMDJcIiwgMzAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUGFyYWdyYXBoKHdvcmRzLCBzdHlsZURlc2NyaXB0aW9uID8/IERFRkFVTFRfU1RZTEVTWzBdLmRlc2NyaXB0aW9uKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXMuc3VjY2Vzcykge1xuICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDE2KS5yZXBsYWNlKCdUJywgJyAnKTsgXG4gICAgICAgICAgICAvLyBcdTU3MjhcdTc1MUZcdTYyMTBcdTc2ODRcdTUxODVcdTVCQjlcdTRFMkRcdTUyQTBcdTUxNjVcdTZFOTBcdTY1ODdcdTRFRjZcdTRGRTFcdTYwNkZcbiAgICAgICAgICAgIGNvbnN0IG91dHB1dENvbnRlbnQgPSBgXFxuLS0tXFxuIyMjIyR7bm93fVxcblNvdXJjZTogW1ske2FjdGl2ZUZpbGUucGF0aH1dXVxcblxcbiR7cmVzLnRleHR9XFxuYDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgdGhpcy5hcHBlbmRPckNyZWF0ZUZpbGUodGhpcy5zZXR0aW5ncy5vdXRwdXRGaWxlUGF0aCwgb3V0cHV0Q29udGVudCwgXCJcdTY1ODdcdTdBRTBcIik7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYFx1Mjc0QyBcdTc1MUZcdTYyMTBcdTU5MzFcdThEMjVcdUZGMENcdThCRjdcdTY3RTVcdTc3MEJcdTYzQTdcdTUyMzZcdTUzRjBcdTY1RTVcdTVGRDdcdTMwMDJgLCA1MDAwKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBcdTI3NEMgR2VuZXJhdGlvbiBmYWlsZWQsIGZpbmFsIHJlc3VsdDogJHtyZXMudGV4dH1gKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBQMS9QMjogXHU4Rjg1XHU1MkE5XHU1MUZEXHU2NTcwXHVGRjBDXHU3ODZFXHU0RkREXHU2NTg3XHU0RUY2XHU4REVGXHU1Rjg0XHU1QjU4XHU1NzI4XHU1RTc2XHU4RkZEXHU1MkEwXHU1MTg1XHU1QkI5XG4gICAgICovXG4gICAgYXN5bmMgYXBwZW5kT3JDcmVhdGVGaWxlKGZpbGVQYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZywgdHlwZTogc3RyaW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB2YXVsdCA9IHRoaXMuYXBwLnZhdWx0O1xuICAgICAgICAgICAgY29uc3QgZm9sZGVyUGF0aCA9IGZpbGVQYXRoLnN1YnN0cmluZygwLCBmaWxlUGF0aC5sYXN0SW5kZXhPZignLycpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gXHU3ODZFXHU0RkREXHU3NkVFXHU1RjU1XHU1QjU4XHU1NzI4XG4gICAgICAgICAgICBpZiAoZm9sZGVyUGF0aCAmJiAhKGF3YWl0IHZhdWx0LmFkYXB0ZXIuZXhpc3RzKGZvbGRlclBhdGgpKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHZhdWx0LmNyZWF0ZUZvbGRlcihmb2xkZXJQYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmaWxlUGF0aCk7XG5cbiAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICAvLyBcdTY1ODdcdTRFRjZcdTVERjJcdTVCNThcdTU3MjhcdUZGMENcdThGRkRcdTUyQTBcdTUxODVcdTVCQjlcbiAgICAgICAgICAgICAgICBhd2FpdCB2YXVsdC5hcHBlbmQoZmlsZSwgY29udGVudCk7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgXHUyNzA1ICR7dHlwZX1cdTVERjJcdThGRkRcdTUyQTBcdTUyMzAgJHtmaWxlUGF0aH1gLCA0MDAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gXHU2NTg3XHU0RUY2XHU0RTBEXHU1QjU4XHU1NzI4XHVGRjBDXHU1MjFCXHU1RUZBXHU1RTc2XHU1MTk5XHU1MTY1XHU1MTg1XHU1QkI5XG4gICAgICAgICAgICAgICAgYXdhaXQgdmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBjb250ZW50KTtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBcdTI3MDUgJHt0eXBlfVx1NjU4N1x1NEVGNlx1NURGMlx1NTIxQlx1NUVGQTogJHtmaWxlUGF0aH1gLCA0MDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbmV3IE5vdGljZShgXHUyNzRDIFx1NjVFMFx1NkNENVx1NTE5OVx1NTE2NSR7dHlwZX1cdTY1ODdcdTRFRjY6ICR7ZmlsZVBhdGh9YCwgNTAwMCk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRmlsZSB3cml0ZSBlcnJvcjpcIiwgZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PSBcdThGODVcdTUyQTlcdTUxRkRcdTY1NzAgKFx1NjgzOFx1NUZDM1x1OTAzQlx1OEY5MSkgPT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIC8vIC4uLiAoZXh0cmFjdFdvcmRzRnJvbU1kQ29udGVudCwgY29udGFpbnNBbGwgXHU2NUI5XHU2Q0Q1XHU0RkREXHU2MzAxXHU0RTBEXHU1M0Q4KSAuLi5cblx0cHJpdmF0ZSBleHRyYWN0d29yZHNEZWZpbml0aW9ucyhjb250ZW50OnN0cmluZyk6IE1hcDxzdHJpbmcsc3RyaW5nPntcblxuXHRcdGNvbnN0IHBhdHRlcm4gPSAvXFxbXFxeXFxkK106XFxzKihbXjpcXG5dKyk6XFxzKiguKykvZ207XG5cdFx0Y29uc3QgbWF0Y2hlcyA9IFsuLi5jb250ZW50Lm1hdGNoQWxsKHBhdHRlcm4pXTtcblx0XHRjb25zdCB3b3JkRGVmTWFwID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcbiAgICBcdGZvciAoY29uc3QgbWF0Y2ggb2YgbWF0Y2hlcykge1x0XG4gICAgICAgIC8vIG1hdGNoWzFdIFx1NjYyRiAnXHU1MzU1XHU4QkNEJyAoV29yZClcbiAgICAgICAgXHRjb25zdCB3b3JkID0gbWF0Y2hbMV0udHJpbSgpOyBcbiAgICAgICAgLy8gbWF0Y2hbMl0gXHU2NjJGICdcdTVCOUFcdTRFNDknIChEZWZpbml0aW9uKVxuICAgICAgICBcdGNvbnN0IGRlZmluaXRpb24gPSBtYXRjaFsyXS50cmltKCk7IFxuICAgICAgICAvLyBcdTRFQzVcdTU5MDRcdTc0MDZcdTRFMERcdTRFM0FcdTdBN0FcdTRFMTRcdTVDMUFcdTY3MkFcdTZERkJcdTUyQTBcdTc2ODRcdTUzNTVcdThCQ0RcbiAgICAgICAgXHRpZiAod29yZCAmJiAhd29yZERlZk1hcC5oYXMod29yZCkpIHtcbiAgICAgICAgICAgIFx0d29yZERlZk1hcC5zZXQod29yZCwgZGVmaW5pdGlvbik7XG4gICAgICAgIFx0fVxuICAgXHRcdH1cbiAgICBcdHJldHVybiB3b3JkRGVmTWFwO1xuXHR9XG5cblx0cHJpdmF0ZSBhc3luYyBsb2FkRXhpc3RpbmdXb3JkcyhmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxTZXQ8c3RyaW5nPj4ge1xuXHRcdGNvbnN0IGV4aXN0aW5nV29yZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblx0XHRjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcblxuXHRcdGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuXHRcdFx0XHQvLyBcdTUzMzlcdTkxNERcdTY4M0NcdTVGMEY6ICMgV29yZE5hbWVcblx0XHRcdFx0Y29uc3QgcGF0dGVybiA9IC9eI1xccyooW14jXFxuXSspJC9nbTtcblx0XHRcdFx0bGV0IG1hdGNoO1xuXHRcdFx0XHR3aGlsZSAoKG1hdGNoID0gcGF0dGVybi5leGVjKGNvbnRlbnQpKSAhPT0gbnVsbCkge1xuXHRcdFx0XHRcdGV4aXN0aW5nV29yZHMuYWRkKG1hdGNoWzFdLnRyaW0oKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIkVycm9yIHJlYWRpbmcgZXhpc3Rpbmcga2V5d29yZHMgZmlsZTpcIiwgZSk7XG5cdFx0XHRcdC8vIFx1NTk4Mlx1Njc5Q1x1OEJGQlx1NTNENlx1NTkzMVx1OEQyNVx1RkYwQ1x1ODlDNlx1NEUzQVx1NkNBMVx1NjcwOVx1NzNCMFx1NjcwOVx1NTM1NVx1OEJDRFxuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gZXhpc3RpbmdXb3Jkcztcblx0fVxuXG5cdC8qKlxuXHQgKiBcdTVCOUVcdTczQjAgUHl0aG9uIFx1NEUyRFx1NzY4NCBjb252ZXJ0X2RpY3RfdG9fYmxvY2tzIFx1OTAzQlx1OEY5MVx1MzAwMlxuXHQgKiBcdTVDMDZcdTYzRDBcdTUzRDZcdTc2ODQgTWFwIFx1OEY2Q1x1NjM2Mlx1NEUzQVx1NjVCMFx1NTE3M1x1OTUyRVx1OEJDRFx1NjU4N1x1NEVGNlx1NzY4NFx1OEZGRFx1NTJBMFx1NTE4NVx1NUJCOVx1RkYwQ1x1NjgzQ1x1NUYwRlx1NEUzQVx1NTIwNlx1NTc1N1x1MzAwMlxuXHQgKi9cblx0cHJpdmF0ZSBjb252ZXJ0RGljdFRvQmxvY2tzKHdvcmREZWZNYXA6IE1hcDxzdHJpbmcsIHN0cmluZz4sIGV4aXN0aW5nV29yZHM6IFNldDxzdHJpbmc+KTogc3RyaW5nIHtcblx0XHRjb25zdCBibG9ja3M6IHN0cmluZ1tdID0gW107XG5cdFx0Y29uc3Qgc29ydGVkV29yZHMgPSBBcnJheS5mcm9tKHdvcmREZWZNYXAua2V5cygpKS5zb3J0KCk7XG5cblx0XHRmb3IgKGNvbnN0IHdvcmQgb2Ygc29ydGVkV29yZHMpIHtcblx0XHRcdC8vIFx1OERGM1x1OEZDN1x1NURGMlx1NUI1OFx1NTcyOFx1NzY4NFx1NTM1NVx1OEJDRFxuXHRcdFx0aWYgKGV4aXN0aW5nV29yZHMuaGFzKHdvcmQpKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBkZWZpbml0aW9uID0gd29yZERlZk1hcC5nZXQod29yZCkgfHwgJyc7XG5cdFx0XHQvLyBcdTY4M0NcdTVGMEY6IC0tLSBcXG4jIFdvcmQgXFxuXFxuIERlZmluaXRpb25cblx0XHRcdGNvbnN0IGJsb2NrID0gYCMgJHt3b3JkfVxcblxcbiR7ZGVmaW5pdGlvbn1cXG5cXG4tLS1cXG5gO1xuXHRcdFx0YmxvY2tzLnB1c2goYmxvY2spO1xuXHRcdH1cblx0XHRcblx0XHQvLyBcdTU5ODJcdTY3OUNcdTZDQTFcdTY3MDlcdTY1QjBcdTUxODVcdTVCQjlcdUZGMENcdThGRDRcdTU2REVcdTdBN0FcdTVCNTdcdTdCMjZcdTRFMzJcblx0XHRpZiAoYmxvY2tzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFwiXCI7XG5cblx0XHRyZXR1cm4gYmxvY2tzLmpvaW4oJycpO1xuXHR9XG4gICAgcHJpdmF0ZSBleHRyYWN0V29yZHNGcm9tTWRDb250ZW50KGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICAgICAgY29uc3QgcGF0dGVybiA9IC9cXFtcXF5cXGQrXTpcXHMqKFtBLVphLXpcXC0nXSspKD86OnxcXHN8JCkvZ207IFxuICAgICAgICBjb25zdCBtYXRjaGVzID0gWy4uLmNvbnRlbnQubWF0Y2hBbGwocGF0dGVybildO1xuICAgICAgICBjb25zdCB3b3JkcyA9IG1hdGNoZXMubWFwKG1hdGNoID0+IG1hdGNoWzFdLnRyaW0oKSk7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQod29yZHMpKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBjb250YWluc0FsbCh0ZXh0OiBzdHJpbmcsIHJlcXVpcmVkV29yZHM6IHN0cmluZ1tdKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHRleHRMb3dlciA9IHRleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgZm9yIChjb25zdCB3b3JkIG9mIHJlcXVpcmVkV29yZHMpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXNjYXBlZFdvcmQgPSB3b3JkLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvWy1cXC9cXFxcXiQqKz8uKCl8W1xcXXt9XS9nLCAnXFxcXCQmJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKCdcXFxcYicgKyBlc2NhcGVkV29yZCArICdcXFxcYicsICdnJyk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZWdleC50ZXN0KHRleHRMb3dlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBSZWdleCBjcmVhdGlvbiBmYWlsZWQgZm9yIHdvcmQ6ICR7d29yZH1gLCBlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXHU2Nzg0XHU1RUZBXHU1M0QxXHU5MDAxXHU3RUQ5IERlZXBTZWVrIEFQSSBcdTc2ODRcdTc1MjhcdTYyMzdcdTYzRDBcdTc5M0FcdUZGMENcdTRGN0ZcdTc1Mjggc3R5bGUgXHU1M0MyXHU2NTcwXHUzMDAyXG4gICAgICovXG4gICAgcHJpdmF0ZSBidWlsZFByb21wdChyZXF1aXJlZFdvcmRzOiBzdHJpbmdbXSwgbGVuZ3RoRGVzY3JpcHRpb246IHN0cmluZyA9IFwiXHU3RUE2NTAwXHU4QkNEXCIsIHN0eWxlOiBzdHJpbmcgPSBERUZBVUxUX1NUWUxFU1swXS5kZXNjcmlwdGlvbik6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHdvcmRzTGluZSA9IHJlcXVpcmVkV29yZHMuam9pbihcIiwgXCIpO1xuICAgICAgICBjb25zdCBwcm9tcHQgPSAoXG4gICAgICAgICAgICBgXHU4QkY3XHU3NTI4XHU4MkYxXHU2NTg3XHU1MTk5XHU0RTAwXHU3QkM3JHtsZW5ndGhEZXNjcmlwdGlvbn1cdThGREVcdThEMkZcdTU5MUFcdTZCQjVcdTg0M0RcdTc2ODRcdTY1ODdcdTdBRTBcdUZGMENcdTk4Q0VcdTY4M0NcdUZGMUEke3N0eWxlfVx1RkYwQ1x1NTE3N1x1NjcwOVx1NEUwMFx1NUI5QVx1NjU0NVx1NEU4Qlx1NjBDNVx1ODI4Mlx1MzAwMlxcbmAgK1xuICAgICAgICAgICAgYFx1ODk4MVx1NkM0Mlx1RkYxQVx1NjU4N1x1N0FFMFx1NEUyRFx1NUZDNVx1OTg3Qlx1NTMwNVx1NTQyQlx1NEVFNVx1NEUwQlx1NTE3M1x1OTUyRVx1OEJDRFx1RkYwOFx1NEVGQlx1NjEwRlx1OEJDRFx1NUY2Mlx1NTNEOFx1NTMxNlx1NTc0N1x1NTNFRlx1RkYwOVx1RkYxQSR7d29yZHNMaW5lfVx1MzAwMlx1NUU3Nlx1NTcyOFx1N0VEM1x1Njc5Q1x1NEUyRFx1NUMwNlx1NzZGOFx1NUU5NFx1NTM1NVx1OEJDRFx1NjIxNlx1ODAwNVx1NTE3Nlx1NTNEOFx1NUY2Mlx1NTJBMFx1N0M5N1xcbmAgK1xuICAgICAgICAgICAgXCJcdTRFMERcdTg5ODFcdTRGN0ZcdTc1MjhcdTk4NzlcdTc2RUVcdTdCMjZcdTUzRjdcdUZGMENcdTUzRUZcdTUyMDZcdTZCQjVcdUZGMENcdTRGRERcdTYzMDFcdTgxRUFcdTcxMzZcdThGREVcdThEMkZcdTc2ODRcdThCRURcdTZDMTRcdTMwMDJcIlxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gcHJvbXB0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFx1NjgzOFx1NUZDM1x1NzUxRlx1NjIxMFx1NTFGRFx1NjU3MFx1RkYwQ1x1NEYyMFx1NTE2NSBzdHlsZSBcdTUzQzJcdTY1NzBcdTMwMDJcbiAgICAgKi9cbiAgICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlUGFyYWdyYXBoKFxuICAgICAgICByZXF1aXJlZFdvcmRzOiBzdHJpbmdbXSwgXG4gICAgICAgIHN0eWxlRGVzY3JpcHRpb246IHN0cmluZyxcbiAgICAgICAgbGVuZ3RoRGVzYzogc3RyaW5nID0gXCJcdTdFQTY0MDBcdThCQ0RcIlxuICAgICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuLCB0ZXh0OiBzdHJpbmcgfT4geyBcblxuICAgICAgICAvLyAuLi4gKEFQSSBLZXkvVVJML0hlYWRlcnMgXHU2OEMwXHU2N0U1XHU1NDhDXHU4QkJFXHU3RjZFXHU0RTBEXHU1M0Q4KSAuLi5cbiAgICAgICAgY29uc3QgeyBhcGlLZXksIGFwaVVybCwgbW9kZWwsIG1heEF0dGVtcHRzIH0gPSB0aGlzLnNldHRpbmdzO1xuXG4gICAgICAgIGlmICghYXBpS2V5KSB7XG4gICAgICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIERlZXBTZWVrIEFQSSBLZXkgXHU2NzJBXHU4QkJFXHU3RjZFXHUzMDAyXHU4QkY3XHU2OEMwXHU2N0U1XHU2M0QyXHU0RUY2XHU4QkJFXHU3RjZFXHUzMDAyXCIsIDgwMDApO1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHRleHQ6IFwiQVBJIEtleSBNaXNzaW5nXCIgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgICAgICBcIkF1dGhvcml6YXRpb25cIjogYEJlYXJlciAke2FwaUtleX1gLFxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IFwiXHU0RjYwXHU2NjJGXHU0RTAwXHU0RTJBXHU2NEM1XHU5NTdGXHU1MTk5XHU0RjVDXHU3Njg0XHU4MkYxXHU2NTg3XHU2NTg3XHU3QUUwXHU3NTFGXHU2MjEwXHU1MkE5XHU2MjRCXHUzMDAyXCI7XG4gICAgICAgIC8vIFx1NEYyMFx1OTAxMlx1OTAwOVx1NUI5QVx1NzY4NFx1OThDRVx1NjgzQ1xuICAgICAgICBsZXQgdXNlclByb21wdCA9IHRoaXMuYnVpbGRQcm9tcHQocmVxdWlyZWRXb3JkcywgbGVuZ3RoRGVzYywgc3R5bGVEZXNjcmlwdGlvbik7XG4gICAgICAgIGxldCBsYXN0VGV4dCA9IFwiXCI7XG5cbiAgICAgICAgZm9yIChsZXQgYXR0ZW1wdCA9IDE7IGF0dGVtcHQgPD0gbWF4QXR0ZW1wdHM7IGF0dGVtcHQrKykge1xuICAgICAgICAgICAgbmV3IE5vdGljZShgXHVEODNFXHVERDE2IEF0dGVtcHQgJHthdHRlbXB0fS8ke21heEF0dGVtcHRzfSB0byBnZW5lcmF0ZS4uLmApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICAgICAgICAgIG1vZGVsOiBtb2RlbCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgICAgICAgICAgICB7XCJyb2xlXCI6IFwic3lzdGVtXCIsIFwiY29udGVudFwiOiBzeXN0ZW1Qcm9tcHR9LFxuICAgICAgICAgICAgICAgICAgICB7XCJyb2xlXCI6IFwidXNlclwiLCBcImNvbnRlbnRcIjogdXNlclByb21wdH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICB0ZW1wZXJhdHVyZTogMC44LFxuICAgICAgICAgICAgICAgIG1heF90b2tlbnM6IDEwMjQsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyAuLi4gKFx1OEJGN1x1NkM0Mlx1OTAzQlx1OEY5MVx1NTQ4Q1x1OTUxOVx1OEJFRlx1NTkwNFx1NzQwNlx1NEZERFx1NjMwMVx1NEUwRFx1NTNEOCkgLi4uXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdFVybCh7IHVybDogYXBpVXJsLCBtZXRob2Q6ICdQT1NUJywgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksIGhlYWRlcnM6IGhlYWRlcnMsIHRocm93OiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsgdGhyb3cgbmV3IEVycm9yKFwiXHUyNzRDIEF1dGhlbnRpY2F0aW9uIEZhaWxlZC5cIik7IH1cbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHsgdGhyb3cgbmV3IEVycm9yKGBBUEkgRXJyb3IgJHtyZXNwb25zZS5zdGF0dXN9OiAke0pTT04ucGFyc2UocmVzcG9uc2UudGV4dCkuZXJyb3I/Lm1lc3NhZ2UgfHwgcmVzcG9uc2UudGV4dH1gKTsgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UudGV4dCk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGRhdGEuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudD8udHJpbSgpIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgbGFzdFRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICghdGV4dCkgeyB0aHJvdyBuZXcgRXJyb3IoXCJBUEkgcmV0dXJuZWQgZW1wdHkgY29udGVudC5cIik7IH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zQWxsKHRleHQsIHJlcXVpcmVkV29yZHMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHRleHQ6IHRleHQgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtaXNzaW5nID0gcmVxdWlyZWRXb3Jkcy5maWx0ZXIodyA9PiAhdGhpcy5jb250YWluc0FsbCh0ZXh0LCBbd10pKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBBdHRlbXB0ICR7YXR0ZW1wdH0gbWlzc2luZyB3b3JkczogJHttaXNzaW5nLmpvaW4oJywgJyl9YCk7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJQcm9tcHQgPSB0aGlzLmJ1aWxkUHJvbXB0KHJlcXVpcmVkV29yZHMsIGxlbmd0aERlc2MsIHN0eWxlRGVzY3JpcHRpb24pICsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBcXG5cdTZDRThcdTYxMEZcdUZGMUFcdTRFMEFcdTZCMjFcdThGOTNcdTUxRkFcdTdGM0FcdTVDMTFcdThGRDlcdTRFOUJcdTUxNzNcdTk1MkVcdThCQ0RcdUZGMUEke21pc3Npbmcuam9pbignLCAnKX1cdUZGMENcdThCRjdcdTUyQTFcdTVGQzVcdTUzMDVcdTU0MkJcdTMwMDJgO1xuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBcdTI3NEMgXHU3NTFGXHU2MjEwXHU4RkM3XHU3QTBCXHU0RTJEXHU1M0QxXHU3NTFGXHU5NTE5XHU4QkVGOiAke2Vycm9yLm1lc3NhZ2V9YCwgMTAwMDApO1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB0ZXh0OiBgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBuZXcgTm90aWNlKFwiXHUyNzRDIFx1OEZCRVx1NTIzMFx1NjcwMFx1NTkyN1x1NUMxRFx1OEJENVx1NkIyMVx1NjU3MFx1RkYwQ1x1NzUxRlx1NjIxMFx1NTkzMVx1OEQyNVx1MzAwMlwiLCA1MDAwKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHRleHQ6IGxhc3RUZXh0IHx8IFwiTWF4aW11bSBhdHRlbXB0cyByZWFjaGVkLCBubyB2YWxpZCBjb250ZW50IGdlbmVyYXRlZC5cIiB9O1xuICAgIH1cbn1cblxuLy8gLS0tIDMuIFA0L1A1OiBcdTk4Q0VcdTY4M0NcdTkwMDlcdTYyRTkgTW9kYWwgXHU3QzdCIC0tLVxuXG5jbGFzcyBHZW5lcmF0ZVN0eWxlTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gICAgYWN0aXZlRmlsZTogVEZpbGU7XG4gICAgY2FsbGJhY2s6IChzdHlsZTogQWlTdHlsZSB8IG51bGwpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgYWN0aXZlRmlsZTogVEZpbGUsIGNhbGxiYWNrOiAoc3R5bGU6IEFpU3R5bGUgfCBudWxsKSA9PiB2b2lkKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMuYWN0aXZlRmlsZSA9IGFjdGl2ZUZpbGU7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiBgU2VsZWN0IEFydGljbGUgU3R5bGUgZm9yOiAke3RoaXMuYWN0aXZlRmlsZS5uYW1lfWAgfSk7XG5cbiAgICAgICAgREVGQVVMVF9TVFlMRVMuZm9yRWFjaChzdHlsZSA9PiB7XG4gICAgICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAgICAgLnNldE5hbWUoc3R5bGUubmFtZSlcbiAgICAgICAgICAgICAgICAuc2V0RGVzYyhzdHlsZS5kZXNjcmlwdGlvbilcbiAgICAgICAgICAgICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoXCJTZWxlY3RcIilcbiAgICAgICAgICAgICAgICAgICAgLnNldEN0YSgpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2soc3R5bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gXHU2REZCXHU1MkEwXHU0RTAwXHU0RTJBXHU1M0Q2XHU2RDg4XHU2MzA5XHU5NEFFXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IGJ1dHRvblxuICAgICAgICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiQ2FuY2VsXCIpXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIG9uQ2xvc2UoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICB9XG59XG5cblxuLy8gLS0tIDQuIFx1OEJCRVx1N0Y2RSBUYWIgXHU3QzdCIChQMS9QMi9QMzogXHU5MTREXHU3RjZFXHU4REVGXHU1Rjg0XHU1NDhDIEFQSSBLZXkpIC0tLVxuXG5jbGFzcyBEZWVwc2Vla1NldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgICBwbHVnaW46IERlZXBzZWVrR2VuZXJhdG9yUGx1Z2luO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogRGVlcHNlZWtHZW5lcmF0b3JQbHVnaW4pIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBkaXNwbGF5KCk6IHZvaWQge1xuICAgICAgICBjb25zdCB7Y29udGFpbmVyRWx9ID0gdGhpcztcblxuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDInLCB7dGV4dDogJ2Zvb3Rub3RlbGVhcm4gU2V0dGluZ3MnfSk7XG5cbiAgICAgICAgLy8gQVBJIEtleVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdEZWVwU2VlayBBUEkgS2V5JylcbiAgICAgICAgICAgIC5zZXREZXNjKCdFbnRlciB5b3VyIERlZXBTZWVrIEFQSSBLZXkgKHNrLXh4eHh4eHh4Li4uKS4nKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdzay14eHh4eHh4eC4uLicpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaUtleSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoZGVib3VuY2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaUtleSA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSwgNTAwKSkpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAvLyBQMTogQUkgXHU3NTFGXHU2MjEwXHU1MTg1XHU1QkI5XHU4RjkzXHU1MUZBXHU4REVGXHU1Rjg0XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0dlbmVyYXRlZCBBcnRpY2xlcyBGaWxlIFBhdGgnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1RoZSBwYXRoIHRvIHRoZSBmaWxlIHdoZXJlIEFJIGdlbmVyYXRlZCBhcnRpY2xlcyB3aWxsIGJlIGFwcGVuZGVkIChlLmcuLCBEZWVwU2Vlay9HZW5lcmF0ZWRfQXJ0aWNsZXMubWQpLicpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0RlZXBTZWVrL0dlbmVyYXRlZF9BcnRpY2xlcy5tZCcpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm91dHB1dEZpbGVQYXRoKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShkZWJvdW5jZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Mub3V0cHV0RmlsZVBhdGggPSB2YWx1ZS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0sIDUwMCkpKTtcblxuICAgICAgICAvLyBQMjogXHU1MTczXHU5NTJFXHU4QkNEXHU2NDU4XHU1RjU1XHU4RjkzXHU1MUZBXHU4REVGXHU1Rjg0XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0V4dHJhY3RlZCBLZXl3b3JkcyBGaWxlIFBhdGgnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1RoZSBwYXRoIHRvIHRoZSBmaWxlIHdoZXJlIGV4dHJhY3RlZCBrZXl3b3JkcyB3aWxsIGJlIGFwcGVuZGVkIChlLmcuLCBEZWVwU2Vlay9FeHRyYWN0ZWRfS2V5d29yZHMubWQpLicpXG4gICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ0RlZXBTZWVrL0V4dHJhY3RlZF9LZXl3b3Jkcy5tZCcpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmtleXdvcmRzRmlsZVBhdGgpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGRlYm91bmNlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5rZXl3b3Jkc0ZpbGVQYXRoID0gdmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9LCA1MDApKSk7XG5cbiAgICAgICAgLy8gQVBJIFVSTCAoXHU0RkREXHU3NTU5KVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdEZWVwU2VlayBBUEkgVVJMJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdUaGUgVVJMIGZvciB0aGUgRGVlcFNlZWsgQ2hhdCBBUEkuJylcbiAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignaHR0cHM6Ly9hcGkuZGVlcHNlZWsuY29tL3YxLy4uLicpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaVVybClcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoZGVib3VuY2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaVVybCA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSwgNTAwKSkpO1xuXG4gICAgICAgIC8vIE1heCBBdHRlbXB0cyAoXHU0RkREXHU3NTU5KVxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdNYXhpbXVtIEF0dGVtcHRzJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdNYXggbnVtYmVyIG9mIHJldHJpZXMgaWYga2V5d29yZHMgYXJlIG1pc3NlZC4nKVxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XG4gICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCczJylcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzLm1heEF0dGVtcHRzKSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoZGVib3VuY2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBudW0gPSBwYXJzZUludCh2YWx1ZS50cmltKCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4obnVtKSB8fCBudW0gPCAxKSBudW0gPSAzO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5tYXhBdHRlbXB0cyA9IG51bTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSwgNTAwKSkpO1xuICAgIH1cbn0iXSwKICAibWFw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
